define(["exports","leaflet","require"],function(t,e,r){"use strict";function i(t,e){this.x=t,this.y=e}function n(t,e,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,t.readFields(o,this,e)}function o(t,e,r){1==t?e.id=r.readVarint():2==t?s(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function s(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}function a(t){var e=t.length;if(e<=1)return[t];for(var r,i,n=[],o=0;o<e;o++){var s=u(t[o]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(r&&n.push(r),r=[t[o]]):r.push(t[o]))}return r&&n.push(r),n}function u(t){for(var e,r,i=0,n=0,o=t.length,s=o-1;n<o;s=n++)e=t[n],r=t[s],i+=(r.x-e.x)*(e.y+r.y);return i}function h(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(f,this,e),this.length=this._features.length}function f(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(c(r))}function c(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}function l(t,e){this.layers=t.readFields(d,{},e)}function d(t,e,r){if(3===t){var i=new st(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i)}}function p(t,r,i,n,o){var s=new e.Layer(o);Object.getPrototypeOf(s);o=e.extend({},o),s.feature=t,s.layerName=r,s.properties=t.properties,s.addTo=function(t){s._map=t,s.addInteractiveTarget(a)},s.removeFrom=function(t){s.removeInteractiveTarget(a),delete s._map},s.setStyle=function(t){var r=a;return t=e.extend({},"Polygon"===u?e.Polygon.prototype.options:e.Path.prototype.options,t),t.stroke?(r.setAttribute("stroke",t.color),r.setAttribute("stroke-opacity",t.opacity),r.setAttribute("stroke-width",t.weight),r.setAttribute("stroke-linecap",t.lineCap),r.setAttribute("stroke-linejoin",t.lineJoin),t.dashArray?r.setAttribute("stroke-dasharray",t.dashArray):r.removeAttribute("stroke-dasharray"),t.dashOffset?r.setAttribute("stroke-dashoffset",t.dashOffset):r.removeAttribute("stroke-dashoffset")):r.setAttribute("stroke","none"),t.fill?(r.setAttribute("fill",t.fillColor||t.color),r.setAttribute("fill-opacity",t.fillOpacity),r.setAttribute("fill-rule",t.fillRule||"evenodd")):r.setAttribute("fill","none"),t.interactive?(r.setAttribute("pointer-events","auto"),e.DomUtil.addClass(r,"leaflet-interactive")):(e.DomUtil.removeClass(r,"leaflet-interactive"),r.removeAttribute("pointer-events")),r};var a=e.SVG.create("path"),u=ht.types[t.type];switch(u){case"Point":break;case"LineString":case"Polygon":var h=t.loadGeometry().map(function(t){return t.map(function(t){return e.point(t).scaleBy(n)})});a.setAttribute("d",e.SVG.pointsToPath(h,"Polygon"===u)),o.className&&e.DomUtil.addClass(a,o.className),s.setStyle(o),i.appendChild(a)}return s}function v(t,r){function i(t,e,i){var n=r.getFeatureStyle(t,e);if(n){var o=p(t,e,a,i,n);u.push(o),r.addFeatureLayer(o)}}var n={},o=r.getTileSize(),s=e.SVG.create("svg"),a=e.SVG.create("g"),u=[];return s.setAttribute("viewBox",[0,0,o.x,o.y].join(" ")),s.appendChild(a),n.addVectorTile=function(t){return Object.keys(t.layers).forEach(function(e){for(var r=t.layers[e],n=o.divideBy(r.extent),s=0;s!=r.length;++s){var a=r.feature(s);i(a,e,n)}}),n},n.eachFeatureLayer=function(t){return u.map(t)},n.domElement=function(){return s},n.coords=function(){return t},n}function y(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function w(t,e,r){var i,n,o=r.buf;if(n=o[r.pos++],i=(112&n)>>4,n<128)return m(t,i,e);if(n=o[r.pos++],i|=(127&n)<<3,n<128)return m(t,i,e);if(n=o[r.pos++],i|=(127&n)<<10,n<128)return m(t,i,e);if(n=o[r.pos++],i|=(127&n)<<17,n<128)return m(t,i,e);if(n=o[r.pos++],i|=(127&n)<<24,n<128)return m(t,i,e);if(n=o[r.pos++],i|=(1&n)<<31,n<128)return m(t,i,e);throw new Error("Expected varint not more than 10 bytes")}function g(t){return t.type===y.Bytes?t.readVarint()+t.pos:t.pos+1}function m(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function b(t,e){var r,i;if(t>=0?(r=t%4294967296|0,i=t/4294967296|0):(r=~(-t%4294967296),i=~(-t/4294967296),4294967295^r?r=r+1|0:(r=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),x(r,i,e),F(i,e)}function x(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}function F(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}function S(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n]}function V(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function k(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function M(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function _(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function A(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function T(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function P(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function B(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function C(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function E(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function D(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function O(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function j(t,e,r){for(var i="",n=e;n<r;){var o=t[n],s=null,a=o>239?4:o>223?3:o>191?2:1;if(n+a>r)break;var u,h,f;1===a?o<128&&(s=o):2===a?(u=t[n+1],128===(192&u)&&(s=(31&o)<<6|63&u,s<=127&&(s=null))):3===a?(u=t[n+1],h=t[n+2],128===(192&u)&&128===(192&h)&&(s=(15&o)<<12|(63&u)<<6|63&h,(s<=2047||s>=55296&&s<=57343)&&(s=null))):4===a&&(u=t[n+1],h=t[n+2],f=t[n+3],128===(192&u)&&128===(192&h)&&128===(192&f)&&(s=(15&o)<<18|(63&u)<<12|(63&h)<<6|63&f,(s<=65535||s>=1114112)&&(s=null))),null===s?(s=65533,a=1):s>65535&&(s-=65536,i+=String.fromCharCode(s>>>10&1023|55296),s=56320|1023&s),i+=String.fromCharCode(s),n+=a}return i}function U(t,e,r){for(var i,n,o=0;o<e.length;o++){if(i=e.charCodeAt(o),i>55295&&i<57344){if(!n){i>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):n=i;continue}if(i<56320){t[r++]=239,t[r++]=191,t[r++]=189,n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(t[r++]=239,t[r++]=191,t[r++]=189,n=null);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128)}return r}function N(){return new Error(Array.prototype.join.call(arguments,": "))}function G(t){return fetch(t).then(function(e){if(e.ok)return e.arrayBuffer();if(404!==e.status)throw N(t,e.status,e.statusText)})}function Z(t){return[t.x,t.y,t.z].join("|")}function z(t,r){function i(t){Object.keys(f).forEach(function(e){return f[e].eachFeatureLayer(t)})}function n(t){var e=r.minDetailZoom,i=r.maxDetailZoom;return void 0!==e&&t<e?e:void 0!==i&&i<t?i:t}function o(t){var e=r.maxZoom,i=r.zoomReverse,o=r.zoomOffset;return i&&(t=e-t),n(t+o)}function s(t){var e=Math.abs(t.x+t.y)%r.subdomains.length;return r.subdomains[e]}function a(t,e){var i=r.getFeatureId,n=r.vectorTileLayerStyles,o=n[e];if(i){var s=i(t);l[s]&&(o=l[s])}if(o instanceof Function&&(o=o(t.properties,0)),o instanceof Array){if(!o.length)return;o=o[0]}return o}var u=new e.GridLayer(r),h=Object.getPrototypeOf(u);r=e.Util.extend({},wt,r),"string"==typeof r.subdomains&&(r.subdomains=r.subdomains.split("")),r.vectorTileLayerStyles&&(r.style=a);var f={};u.on("tileunload",function(t){var e=Z(t.coords),r=f[e];r&&(r.eachFeatureLayer(function(t){return u.removeFeatureLayer(t)}),delete f[e])});var c;u.onAdd=function(t){return c=t,h.onAdd.apply(u,arguments)},u.onRemove=function(t){return c=void 0,h.onRemove.apply(u,arguments)},u.createTile=function(t,e){var r=Z(t),i=f[r]=v(t,u);return G(u.getTileUrl(t)).then(function(t){i.addVectorTile(new ut(new dt(t))),e(null,i)}),i.domElement()},u.getTileUrl=function(i){var n={s:s(i),x:i.x,y:i.y,z:o(i.z)};return e.Util.template(t,e.Util.extend(n,r))},u.setStyle=function(t){return r.style=t,i(function(t){var e=t.feature,r=t.layerName,i=u.getFeatureStyle(e,r);t.setStyle(i)}),u};var l={};return u.setFeatureStyle=function(t,e){return l[t]=e,u.setStyle(r.style),u},u.resetFeatureStyle=function(t){return delete l[t],u.setStyle(r.style),u},u.getTileSize=function(){var t=h.getTileSize.call(u),e=u._tileZoom;return t.divideBy(c.getZoomScale(n(e),e)).round()},u.getFeatureStyle=function(t,e){var i=r.style;return"function"==typeof i?i(t,e):i},u.addFeatureLayer=function(t){return t.addTo(c),t.addEventParent(u),u},u.removeFeatureLayer=function(t){return t.removeEventParent(u),t.removeFrom(c),u},u}function I(){var t=Array.prototype.slice.call(arguments);return Object.keys(t[0]).map(function(e){return t.map(function(t){return t[e]})})}function R(){function t(e,r){var i={};return i.walks=function(){return e},i.distance=function(){return r},i.toString=function(){return[e+" walks",+(r/1e3).toFixed(1)+"km"].join(" â€” ")},i.accumulate=function(i){return t(1+e,i+r)},i}return t(0,0)}function q(t,e){function r(r,s){s!=n[r]&&(n[r]=s,o=t.flatMap(function(t){return I(t.dates,t.distances)}).reduce(function(t,e){return n[e[0].substr(0,4)]?t.accumulate(e[1]):t},R()),e&&e.call(i))}var i={},n={},o=R();return i.addLayer=function(t,e){return t.on("add",r.bind(null,e,!0)).on("remove",r.bind(null,e,!1)),i},i.removeLayer=function(t){return t.off("add").off("remove"),i},i.render=function(){var t=document.createDocumentFragment();if(o.walks()){var e=document.createElement("div");e.textContent=""+o,t.appendChild(e)}return t},i}function W(t,e){for(var r=-1,i=t.length;1+r!==i;){var n=r+(i-r>>1);e(t[n])?i=n:r=n}return i}function X(t){return["hsl(",170+45*(t>>1),",",100,"%,",27*(1+t%2),"%)"].join("")}function J(t,e){var r=W(e.dates,function(e){return t<=e});if(e.dates[r]!==t)return void console.log("walkPopup",t,e);var i=document.createDocumentFragment(),n=document.createElement("div");n.textContent=[[+t.substr(8,2),+t.substr(5,2),+t.substr(0,4)].join("/"),+(e.distances[r]/1e3).toFixed(1)+"km",e.walkers+" walkers",e.categories.join(" â€” "),""].join(" â€” ");var o=document.createElement("a");return o.setAttribute("href",e.link),o.textContent="blog",n.appendChild(o),i.appendChild(n),n=document.createElement("p"),n.textContent=e.people.sort().join(" â€¢ "),i.appendChild(n),{title:e.title,content:i}}function H(t){return t.properties.date}function K(t){var e=window.history.state||{};return t&&(Object.keys(t).forEach(function(r){return e[r]=t[r]}),window.history.replaceState(e,window.document.title)),e}function Q(t){return function(e){if(!arguments.length)return K()[t];K((r={},r[t]=e,r));var r;return e}}function Y(t){if(!arguments.length)return K()["@"];var e=L.latLng(t),r=e.lat,i=e.lng;return K({"@":[r,i].map(function(t){return+t.toFixed(6)})}),t}function $(t,e){var r=[].concat(K().y||[]);if(arguments.length<2)return 0<=r.indexOf(""+t);var i=r.reduce(function(t,e){return t[e]=!0,t},{});i[t]=e;var n=Object.keys(i).filter(function(t){return i[t]}).sort();return K({y:n.length?n:void 0}),e}function tt(t,i){function n(t){var r=t.title,i=t.content,n=e.DomUtil.create("h3");n.textContent=r,e.DomUtil.empty(l),l.appendChild(n),l.appendChild(i)}function o(t){var e=t.properties.date,r=e.substr(0,4);return{className:gt.TRACK,color:X(r-2011),opacity:$(r)?0:e===f?1:.8,weight:e===f?4:e===bt()?3.5:2,interactive:!1}}function s(t){var e=t.properties.date.substr(0,4);return{opacity:0,weight:20,interactive:!$(e)}}var a=i.tileLayers.map(function(t){return{name:t.name,tileLayer:e.tileLayer(t.url,t.options)}}),u=e.control.layers(null,null,{hideSingleBase:!0});a.forEach(function(t){u.addBaseLayer(t.tileLayer,t.name)});var h=e.DomUtil.get(t);e.DomUtil.addClass(h,gt.VBOX);var f,c=e.map(e.DomUtil.create("div",gt.VIEW,h)).addControl(e.control.scale()).addControl(u).addLayer(a[0].tileLayer),l=e.DomUtil.create("div",gt.DETAILS,h),d=z(i.url,{pane:"overlayPane",maxDetailZoom:13,getFeatureId:H,style:o}).addTo(c),p=z(i.url,{pane:"overlayPane",maxDetailZoom:13,getFeatureId:H,style:s,interactive:!0}).on("mouseover",function(t){f=H(t.layer),d.setStyle(o)}).on("mouseout",function(){f=void 0,d.setStyle(o)}).addTo(c);return r(["dA/json!"+i.index],function(t){function r(){var e=bt();if(e){var r=W(t,function(t){return e<t.dates[0]})-1,o=J(e,t[r]);if(o)return n(o)}return n({title:i.title,content:f.render()})}function a(){bt()&&(bt(void 0),d.setStyle(o),r())}var h={};t.flatMap(function(t){return t.dates}).forEach(function(t){return h[t.substr(0,4)]=!0}),p.on("click",function(t){var i=H(t.layer);e.DomEvent.stopPropagation(t),i!==bt()&&(a(),bt(i),d.setStyle(o),r())});var f=q(t,r);c.on("click",a),Object.keys(h).forEach(function(t){var r=e.layerGroup().on("add",function(){$(t)&&($(t,!1),d.setStyle(o),p.setStyle(s))}).on("remove",function(){$(t)||($(t,!0),d.setStyle(o),p.setStyle(s))});$(t)||c.addLayer(r),u.addOverlay(r,t),f.addLayer(r,t)});var l=e.latLngBounds(t.flatMap(function(t){return t.bboxes}).flatMap(function(t){var r=t.length>>1;return e.GeoJSON.coordsToLatLngs([[t[0],t[1]],[t[r],t[1+r]]])}));if(c.setMaxBounds(l.pad(.05)),0<=mt())try{c.setView(Y(),mt())}catch(t){console.error(t),c.fitBounds(l)}else c.fitBounds(l);c.on("moveend",function(){Y(this.getCenter()),mt(this.getZoom())})}),c}r="default"in r?r.default:r,"function"!=typeof Array.prototype.flatMap&&Object.defineProperty(Array.prototype,"flatMap",{value:function(){return Array.prototype.concat.apply([],Array.prototype.map.apply(this,arguments))}});var et=i;i.prototype={clone:function(){return new i(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=i,this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(t){return t instanceof i?t:Array.isArray(t)?new i(t[0],t[1]):t};var rt=et,it=n;n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,n=0,o=0,s=0,a=[];t.pos<r;){if(!n){var u=t.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)o+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&a.push(e),e=[]),e.push(new rt(o,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&a.push(e),a},n.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,o=0,s=1/0,a=-(1/0),u=1/0,h=-(1/0);t.pos<e;){if(!i){var f=t.readVarint();r=7&f,i=f>>3}if(i--,1===r||2===r)n+=t.readSVarint(),o+=t.readSVarint(),n<s&&(s=n),n>a&&(a=n),o<u&&(u=o),o>h&&(h=o);else if(7!==r)throw new Error("unknown command "+r)}return[s,u,a,h]},n.prototype.toGeoJSON=function(t,e,r){function i(t){for(var e=0;e<t.length;e++){var r=t[e],i=180-360*(r.y+f)/u;t[e]=[360*(r.x+h)/u-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}var o,s,u=this.extent*Math.pow(2,r),h=this.extent*t,f=this.extent*e,c=this.loadGeometry(),l=n.types[this.type];switch(this.type){case 1:var d=[];for(o=0;o<c.length;o++)d[o]=c[o][0];c=d,i(c);break;case 2:for(o=0;o<c.length;o++)i(c[o]);break;case 3:for(c=a(c),o=0;o<c.length;o++)for(s=0;s<c[o].length;s++)i(c[o][s])}1===c.length?c=c[0]:l="Multi"+l;var p={type:"Feature",geometry:{type:l,coordinates:c},properties:this.properties};return"id"in this&&(p.id=this.id),p};var nt=it,ot=h;h.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new nt(this._pbf,e,this.extent,this._keys,this._values)};var st=ot,at=l,ut=at,ht=it;"function"!=typeof window.fetch&&(window.fetch=function(t){var e=new XMLHttpRequest;return e.open("GET",t),e.responseType="arraybuffer",new Promise(function(t){e.onload=function(){t({ok:200===e.status,status:e.status,statusText:e.statusText,arrayBuffer:function(){return e.response}})},e.send()})});var ft=function(t,e,r,i,n){var o,s,a=8*n-i-1,u=(1<<a)-1,h=u>>1,f=-7,c=r?n-1:0,l=r?-1:1,d=t[e+c];for(c+=l,o=d&(1<<-f)-1,d>>=-f,f+=a;f>0;o=256*o+t[e+c],c+=l,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=i;f>0;s=256*s+t[e+c],c+=l,f-=8);if(0===o)o=1-h;else{if(o===u)return s?NaN:(d?-1:1)*(1/0);s+=Math.pow(2,i),o-=h}return(d?-1:1)*s*Math.pow(2,o-i)},ct=function(t,e,r,i,n,o){var s,a,u,h=8*o-n-1,f=(1<<h)-1,c=f>>1,l=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:o-1,p=i?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=f):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),e+=s+c>=1?l/u:l*Math.pow(2,1-c),e*u>=2&&(s++,u/=2),s+c>=f?(a=0,s=f):s+c>=1?(a=(e*u-1)*Math.pow(2,n),s+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,n),s=0));n>=8;t[r+d]=255&a,d+=p,a/=256,n-=8);for(s=s<<n|a,h+=n;h>0;t[r+d]=255&s,d+=p,s/=256,h-=8);t[r+d-p]|=128*v},lt={read:ft,write:ct},dt=y,pt=lt;y.Varint=0,y.Fixed64=1,y.Bytes=2,y.Fixed32=5;var vt=4294967296,yt=1/vt;y.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){var i=this;for(r=r||this.length;this.pos<r;){var n=i.readVarint(),o=n>>3,s=i.pos;i.type=7&n,t(o,e,i),i.pos===s&&i.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=E(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=O(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=E(this.buf,this.pos)+E(this.buf,this.pos+4)*vt;return this.pos+=8,t},readSFixed64:function(){var t=E(this.buf,this.pos)+O(this.buf,this.pos+4)*vt;return this.pos+=8,t},readFloat:function(){var t=pt.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=pt.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,i=this.buf;return r=i[this.pos++],e=127&r,r<128?e:(r=i[this.pos++],e|=(127&r)<<7,r<128?e:(r=i[this.pos++],e|=(127&r)<<14,r<128?e:(r=i[this.pos++],e|=(127&r)<<21,r<128?e:(r=i[this.pos],e|=(15&r)<<28,w(e,t,this)))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=j(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var r=this,i=g(this);for(t=t||[];this.pos<i;)t.push(r.readVarint(e));return t},readPackedSVarint:function(t){var e=this,r=g(this);for(t=t||[];this.pos<r;)t.push(e.readSVarint());return t},readPackedBoolean:function(t){var e=this,r=g(this);for(t=t||[];this.pos<r;)t.push(e.readBoolean());return t},readPackedFloat:function(t){var e=this,r=g(this);for(t=t||[];this.pos<r;)t.push(e.readFloat());return t},readPackedDouble:function(t){var e=this,r=g(this);for(t=t||[];this.pos<r;)t.push(e.readDouble());return t},readPackedFixed32:function(t){var e=this,r=g(this);for(t=t||[];this.pos<r;)t.push(e.readFixed32());return t},readPackedSFixed32:function(t){var e=this,r=g(this);for(t=t||[];this.pos<r;)t.push(e.readSFixed32());return t},readPackedFixed64:function(t){var e=this,r=g(this);for(t=t||[];this.pos<r;)t.push(e.readFixed64());return t},readPackedSFixed64:function(t){var e=this,r=g(this);for(t=t||[];this.pos<r;)t.push(e.readSFixed64());return t},skip:function(t){var e=7&t;if(e===y.Varint)for(;this.buf[this.pos++]>127;);else if(e===y.Bytes)this.pos=this.readVarint()+this.pos;else if(e===y.Fixed32)this.pos+=4;else{if(e!==y.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),D(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),D(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),D(this.buf,t&-1,this.pos),D(this.buf,Math.floor(t*yt),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),D(this.buf,t&-1,this.pos),D(this.buf,Math.floor(t*yt),this.pos+4),this.pos+=8},writeVarint:function(t){return t=+t||0,t>268435455||t<0?void b(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),void(t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=U(this.buf,t,this.pos);var r=this.pos-e;r>=128&&S(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),pt.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),pt.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=this,r=t.length;this.writeVarint(r),this.realloc(r);for(var i=0;i<r;i++)e.buf[e.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&S(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,y.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){this.writeMessage(t,V,e)},writePackedSVarint:function(t,e){this.writeMessage(t,k,e)},writePackedBoolean:function(t,e){this.writeMessage(t,A,e)},writePackedFloat:function(t,e){this.writeMessage(t,M,e)},writePackedDouble:function(t,e){this.writeMessage(t,_,e)},writePackedFixed32:function(t,e){this.writeMessage(t,T,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,P,e)},writePackedFixed64:function(t,e){this.writeMessage(t,B,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,C,e)},writeBytesField:function(t,e){this.writeTag(t,y.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,y.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,y.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,y.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,y.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,y.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,y.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,y.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,y.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,y.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var wt={minZoom:0,maxZoom:18,maxDetailZoom:void 0,minDetailZoom:void 0,subdomains:"abc",zoomOffset:0,zoomReverse:!1},gt={DETAILS:"gpxmap-details",HBOX:"gpxmap-hbox",SELECT:"gpxmap-select",TRACK:"gpxmap-track",VBOX:"gpxmap-vbox",VIEW:"gpxmap-view"},mt=Q("z"),bt=Q("s");t.CSS=gt,t.gpxmap=tt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=gpxmap.js.map
