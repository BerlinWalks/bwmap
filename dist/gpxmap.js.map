{"version":3,"file":"gpxmap.js","sources":["../node_modules/point-geometry/index.js","../node_modules/vector-tile/lib/vectortilefeature.js","../node_modules/vector-tile/lib/vectortilelayer.js","../node_modules/vector-tile/lib/vectortile.js","../node_modules/leaflet-vector-tile-layer/js/FeatureLayer.js","../node_modules/leaflet-vector-tile-layer/js/FeatureTile.js","../node_modules/pbf/index.js","../node_modules/leaflet-vector-tile-layer/js/VectorTileLayer.js","../js/summary.js","../js/gpxmap.js","../js/flatMap.js","../node_modules/vector-tile/index.js","../node_modules/leaflet-vector-tile-layer/js/fetch.js","../node_modules/ieee754/index.js"],"sourcesContent":["'use strict';\n\nmodule.exports = Point;\n\nfunction Point(x, y) {\n    this.x = x;\n    this.y = y;\n}\n\nPoint.prototype = {\n    clone: function() { return new Point(this.x, this.y); },\n\n    add:     function(p) { return this.clone()._add(p);     },\n    sub:     function(p) { return this.clone()._sub(p);     },\n    mult:    function(k) { return this.clone()._mult(k);    },\n    div:     function(k) { return this.clone()._div(k);     },\n    rotate:  function(a) { return this.clone()._rotate(a);  },\n    matMult: function(m) { return this.clone()._matMult(m); },\n    unit:    function() { return this.clone()._unit(); },\n    perp:    function() { return this.clone()._perp(); },\n    round:   function() { return this.clone()._round(); },\n\n    mag: function() {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    },\n\n    equals: function(p) {\n        return this.x === p.x &&\n               this.y === p.y;\n    },\n\n    dist: function(p) {\n        return Math.sqrt(this.distSqr(p));\n    },\n\n    distSqr: function(p) {\n        var dx = p.x - this.x,\n            dy = p.y - this.y;\n        return dx * dx + dy * dy;\n    },\n\n    angle: function() {\n        return Math.atan2(this.y, this.x);\n    },\n\n    angleTo: function(b) {\n        return Math.atan2(this.y - b.y, this.x - b.x);\n    },\n\n    angleWith: function(b) {\n        return this.angleWithSep(b.x, b.y);\n    },\n\n    // Find the angle of the two vectors, solving the formula for the cross product a x b = |a||b|sin(θ) for θ.\n    angleWithSep: function(x, y) {\n        return Math.atan2(\n            this.x * y - this.y * x,\n            this.x * x + this.y * y);\n    },\n\n    _matMult: function(m) {\n        var x = m[0] * this.x + m[1] * this.y,\n            y = m[2] * this.x + m[3] * this.y;\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    _add: function(p) {\n        this.x += p.x;\n        this.y += p.y;\n        return this;\n    },\n\n    _sub: function(p) {\n        this.x -= p.x;\n        this.y -= p.y;\n        return this;\n    },\n\n    _mult: function(k) {\n        this.x *= k;\n        this.y *= k;\n        return this;\n    },\n\n    _div: function(k) {\n        this.x /= k;\n        this.y /= k;\n        return this;\n    },\n\n    _unit: function() {\n        this._div(this.mag());\n        return this;\n    },\n\n    _perp: function() {\n        var y = this.y;\n        this.y = this.x;\n        this.x = -y;\n        return this;\n    },\n\n    _rotate: function(angle) {\n        var cos = Math.cos(angle),\n            sin = Math.sin(angle),\n            x = cos * this.x - sin * this.y,\n            y = sin * this.x + cos * this.y;\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    _round: function() {\n        this.x = Math.round(this.x);\n        this.y = Math.round(this.y);\n        return this;\n    }\n};\n\n// constructs Point from an array if necessary\nPoint.convert = function (a) {\n    if (a instanceof Point) {\n        return a;\n    }\n    if (Array.isArray(a)) {\n        return new Point(a[0], a[1]);\n    }\n    return a;\n};\n","'use strict';\n\nvar Point = require('point-geometry');\n\nmodule.exports = VectorTileFeature;\n\nfunction VectorTileFeature(pbf, end, extent, keys, values) {\n    // Public\n    this.properties = {};\n    this.extent = extent;\n    this.type = 0;\n\n    // Private\n    this._pbf = pbf;\n    this._geometry = -1;\n    this._keys = keys;\n    this._values = values;\n\n    pbf.readFields(readFeature, this, end);\n}\n\nfunction readFeature(tag, feature, pbf) {\n    if (tag == 1) feature.id = pbf.readVarint();\n    else if (tag == 2) readTag(pbf, feature);\n    else if (tag == 3) feature.type = pbf.readVarint();\n    else if (tag == 4) feature._geometry = pbf.pos;\n}\n\nfunction readTag(pbf, feature) {\n    var end = pbf.readVarint() + pbf.pos;\n\n    while (pbf.pos < end) {\n        var key = feature._keys[pbf.readVarint()],\n            value = feature._values[pbf.readVarint()];\n        feature.properties[key] = value;\n    }\n}\n\nVectorTileFeature.types = ['Unknown', 'Point', 'LineString', 'Polygon'];\n\nVectorTileFeature.prototype.loadGeometry = function() {\n    var pbf = this._pbf;\n    pbf.pos = this._geometry;\n\n    var end = pbf.readVarint() + pbf.pos,\n        cmd = 1,\n        length = 0,\n        x = 0,\n        y = 0,\n        lines = [],\n        line;\n\n    while (pbf.pos < end) {\n        if (!length) {\n            var cmdLen = pbf.readVarint();\n            cmd = cmdLen & 0x7;\n            length = cmdLen >> 3;\n        }\n\n        length--;\n\n        if (cmd === 1 || cmd === 2) {\n            x += pbf.readSVarint();\n            y += pbf.readSVarint();\n\n            if (cmd === 1) { // moveTo\n                if (line) lines.push(line);\n                line = [];\n            }\n\n            line.push(new Point(x, y));\n\n        } else if (cmd === 7) {\n\n            // Workaround for https://github.com/mapbox/mapnik-vector-tile/issues/90\n            if (line) {\n                line.push(line[0].clone()); // closePolygon\n            }\n\n        } else {\n            throw new Error('unknown command ' + cmd);\n        }\n    }\n\n    if (line) lines.push(line);\n\n    return lines;\n};\n\nVectorTileFeature.prototype.bbox = function() {\n    var pbf = this._pbf;\n    pbf.pos = this._geometry;\n\n    var end = pbf.readVarint() + pbf.pos,\n        cmd = 1,\n        length = 0,\n        x = 0,\n        y = 0,\n        x1 = Infinity,\n        x2 = -Infinity,\n        y1 = Infinity,\n        y2 = -Infinity;\n\n    while (pbf.pos < end) {\n        if (!length) {\n            var cmdLen = pbf.readVarint();\n            cmd = cmdLen & 0x7;\n            length = cmdLen >> 3;\n        }\n\n        length--;\n\n        if (cmd === 1 || cmd === 2) {\n            x += pbf.readSVarint();\n            y += pbf.readSVarint();\n            if (x < x1) x1 = x;\n            if (x > x2) x2 = x;\n            if (y < y1) y1 = y;\n            if (y > y2) y2 = y;\n\n        } else if (cmd !== 7) {\n            throw new Error('unknown command ' + cmd);\n        }\n    }\n\n    return [x1, y1, x2, y2];\n};\n\nVectorTileFeature.prototype.toGeoJSON = function(x, y, z) {\n    var size = this.extent * Math.pow(2, z),\n        x0 = this.extent * x,\n        y0 = this.extent * y,\n        coords = this.loadGeometry(),\n        type = VectorTileFeature.types[this.type],\n        i, j;\n\n    function project(line) {\n        for (var j = 0; j < line.length; j++) {\n            var p = line[j], y2 = 180 - (p.y + y0) * 360 / size;\n            line[j] = [\n                (p.x + x0) * 360 / size - 180,\n                360 / Math.PI * Math.atan(Math.exp(y2 * Math.PI / 180)) - 90\n            ];\n        }\n    }\n\n    switch (this.type) {\n    case 1:\n        var points = [];\n        for (i = 0; i < coords.length; i++) {\n            points[i] = coords[i][0];\n        }\n        coords = points;\n        project(coords);\n        break;\n\n    case 2:\n        for (i = 0; i < coords.length; i++) {\n            project(coords[i]);\n        }\n        break;\n\n    case 3:\n        coords = classifyRings(coords);\n        for (i = 0; i < coords.length; i++) {\n            for (j = 0; j < coords[i].length; j++) {\n                project(coords[i][j]);\n            }\n        }\n        break;\n    }\n\n    if (coords.length === 1) {\n        coords = coords[0];\n    } else {\n        type = 'Multi' + type;\n    }\n\n    var result = {\n        type: \"Feature\",\n        geometry: {\n            type: type,\n            coordinates: coords\n        },\n        properties: this.properties\n    };\n\n    if ('id' in this) {\n        result.id = this.id;\n    }\n\n    return result;\n};\n\n// classifies an array of rings into polygons with outer rings and holes\n\nfunction classifyRings(rings) {\n    var len = rings.length;\n\n    if (len <= 1) return [rings];\n\n    var polygons = [],\n        polygon,\n        ccw;\n\n    for (var i = 0; i < len; i++) {\n        var area = signedArea(rings[i]);\n        if (area === 0) continue;\n\n        if (ccw === undefined) ccw = area < 0;\n\n        if (ccw === area < 0) {\n            if (polygon) polygons.push(polygon);\n            polygon = [rings[i]];\n\n        } else {\n            polygon.push(rings[i]);\n        }\n    }\n    if (polygon) polygons.push(polygon);\n\n    return polygons;\n}\n\nfunction signedArea(ring) {\n    var sum = 0;\n    for (var i = 0, len = ring.length, j = len - 1, p1, p2; i < len; j = i++) {\n        p1 = ring[i];\n        p2 = ring[j];\n        sum += (p2.x - p1.x) * (p1.y + p2.y);\n    }\n    return sum;\n}\n","'use strict';\n\nvar VectorTileFeature = require('./vectortilefeature.js');\n\nmodule.exports = VectorTileLayer;\n\nfunction VectorTileLayer(pbf, end) {\n    // Public\n    this.version = 1;\n    this.name = null;\n    this.extent = 4096;\n    this.length = 0;\n\n    // Private\n    this._pbf = pbf;\n    this._keys = [];\n    this._values = [];\n    this._features = [];\n\n    pbf.readFields(readLayer, this, end);\n\n    this.length = this._features.length;\n}\n\nfunction readLayer(tag, layer, pbf) {\n    if (tag === 15) layer.version = pbf.readVarint();\n    else if (tag === 1) layer.name = pbf.readString();\n    else if (tag === 5) layer.extent = pbf.readVarint();\n    else if (tag === 2) layer._features.push(pbf.pos);\n    else if (tag === 3) layer._keys.push(pbf.readString());\n    else if (tag === 4) layer._values.push(readValueMessage(pbf));\n}\n\nfunction readValueMessage(pbf) {\n    var value = null,\n        end = pbf.readVarint() + pbf.pos;\n\n    while (pbf.pos < end) {\n        var tag = pbf.readVarint() >> 3;\n\n        value = tag === 1 ? pbf.readString() :\n            tag === 2 ? pbf.readFloat() :\n            tag === 3 ? pbf.readDouble() :\n            tag === 4 ? pbf.readVarint64() :\n            tag === 5 ? pbf.readVarint() :\n            tag === 6 ? pbf.readSVarint() :\n            tag === 7 ? pbf.readBoolean() : null;\n    }\n\n    return value;\n}\n\n// return feature `i` from this layer as a `VectorTileFeature`\nVectorTileLayer.prototype.feature = function(i) {\n    if (i < 0 || i >= this._features.length) throw new Error('feature index out of bounds');\n\n    this._pbf.pos = this._features[i];\n\n    var end = this._pbf.readVarint() + this._pbf.pos;\n    return new VectorTileFeature(this._pbf, end, this.extent, this._keys, this._values);\n};\n","'use strict';\n\nvar VectorTileLayer = require('./vectortilelayer');\n\nmodule.exports = VectorTile;\n\nfunction VectorTile(pbf, end) {\n    this.layers = pbf.readFields(readTile, {}, end);\n}\n\nfunction readTile(tag, layers, pbf) {\n    if (tag === 3) {\n        var layer = new VectorTileLayer(pbf, pbf.readVarint() + pbf.pos);\n        if (layer.length) layers[layer.name] = layer;\n    }\n}\n\n","/*\n * Copyright 2017, Joachim Kuebart <joachim.kuebart@gmail.com>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n *   1. Redistributions of source code must retain the above copyright\n *\tnotice, this list of conditions and the following disclaimer.\n *\n *   2. Redistributions in binary form must reproduce the above copyright\n *\tnotice, this list of conditions and the following disclaimer in the\n *\tdocumentation and/or other materials provided with the\n *\tdistribution.\n *\n *   3. Neither the name of the copyright holder nor the names of its\n *\tcontributors may be used to endorse or promote products derived\n *\tfrom this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport {\n\tDomUtil,\n\textend,\n\tLayer,\n\tPath,\n\tpoint,\n\tPolygon,\n\tSVG,\n} from 'leaflet';\nimport { VectorTileFeature } from 'vector-tile';\n\nexport default function featureLayer(feature, layerName, rootGroup, pxPerExtent, options) {\n\tconst self = new Layer(options);\n\tconst m_super = Object.getPrototypeOf(self);\n\n\toptions = extend({}, options)\n\n\tself.feature = feature;\n\tself.layerName = layerName;\n\n\t// Compatibility with Leaflet.VectorGrid\n\tself.properties = feature.properties;\n\n\t/*\n\t * FeatureLayers only serve as event targets and are never actually\n\t * \"added\" to the map, so we override the base class's addTo.\n\t */\n\tself.addTo = function addTo(map) {\n\t\t// Required by addInteractiveTarget.\n\t\tself._map = map;\n\t\tself.addInteractiveTarget(m_path);\n\t};\n\n\tself.removeFrom = function removeFrom(map) {\n\t\tself.removeInteractiveTarget(m_path);\n\t\tdelete self._map;\n\t};\n\n\tself.setStyle = function setStyle(options) {\n\t\tconst path = m_path;\n\n\t\toptions = extend(\n\t\t\t{},\n\t\t\t'Polygon' === m_type\n\t\t\t\t? Polygon.prototype.options\n\t\t\t\t: Path.prototype.options,\n\t\t\toptions\n\t\t);\n\n\t\tif (options.stroke) {\n\t\t\tpath.setAttribute('stroke', options.color);\n\t\t\tpath.setAttribute('stroke-opacity', options.opacity);\n\t\t\tpath.setAttribute('stroke-width', options.weight);\n\t\t\tpath.setAttribute('stroke-linecap', options.lineCap);\n\t\t\tpath.setAttribute('stroke-linejoin', options.lineJoin);\n\n\t\t\tif (options.dashArray) {\n\t\t\t\tpath.setAttribute('stroke-dasharray', options.dashArray);\n\t\t\t} else {\n\t\t\t\tpath.removeAttribute('stroke-dasharray');\n\t\t\t}\n\n\t\t\tif (options.dashOffset) {\n\t\t\t\tpath.setAttribute('stroke-dashoffset', options.dashOffset);\n\t\t\t} else {\n\t\t\t\tpath.removeAttribute('stroke-dashoffset');\n\t\t\t}\n\t\t} else {\n\t\t\tpath.setAttribute('stroke', 'none');\n\t\t}\n\n\t\tif (options.fill) {\n\t\t\tpath.setAttribute('fill', options.fillColor || options.color);\n\t\t\tpath.setAttribute('fill-opacity', options.fillOpacity);\n\t\t\tpath.setAttribute('fill-rule', options.fillRule || 'evenodd');\n\t\t} else {\n\t\t\tpath.setAttribute('fill', 'none');\n\t\t}\n\n\t\tif (options.interactive) {\n\t\t\t/*\n\t\t\t * Leaflet's 'interactive' class only applies to\n\t\t\t * renderers that are immediate descendants of a\n\t\t\t * pane.\n\t\t\t */\n\t\t\tpath.setAttribute('pointer-events', 'auto');\n\t\t\tDomUtil.addClass(path, 'leaflet-interactive');\n\t\t} else {\n\t\t\tDomUtil.removeClass(path, 'leaflet-interactive');\n\t\t\tpath.removeAttribute('pointer-events');\n\t\t}\n\n\t\treturn path;\n\t};\n\n\tconst m_path = SVG.create('path');\n\n\tconst m_type = VectorTileFeature.types[feature.type];\n\tswitch (m_type) {\n\tcase 'Point':\n\t\tbreak;\n\tcase 'LineString':\n\tcase 'Polygon':\n\t\tconst geometry = feature.loadGeometry().map(\n\t\t\tring => ring.map(p => point(p).scaleBy(pxPerExtent))\n\t\t);\n\n\t\tm_path.setAttribute('d',\n\t\t\tSVG.pointsToPath(geometry, 'Polygon' === m_type)\n\t\t);\n\n\t\tif (options.className) {\n\t\t\tDomUtil.addClass(m_path, options.className);\n\t\t}\n\t\tself.setStyle(options);\n\n\t\trootGroup.appendChild(m_path);\n\t\tbreak;\n\t}\n\n\treturn self;\n}\n","/*\n * Copyright 2017, Joachim Kuebart <joachim.kuebart@gmail.com>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n *   1. Redistributions of source code must retain the above copyright\n *\tnotice, this list of conditions and the following disclaimer.\n *\n *   2. Redistributions in binary form must reproduce the above copyright\n *\tnotice, this list of conditions and the following disclaimer in the\n *\tdocumentation and/or other materials provided with the\n *\tdistribution.\n *\n *   3. Neither the name of the copyright holder nor the names of its\n *\tcontributors may be used to endorse or promote products derived\n *\tfrom this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport featureLayer from './FeatureLayer.js';\nimport { SVG } from 'leaflet';\n\nexport default function featureTile(coords, layer) {\n\tconst self = {};\n\tconst m_tileSize = layer.getTileSize();\n\tconst m_svg = SVG.create('svg');\n\tconst m_rootGroup = SVG.create('g');\n\tconst m_layers = [];\n\n\tm_svg.setAttribute('viewBox', [0, 0, m_tileSize.x, m_tileSize.y].join(' '));\n\tm_svg.appendChild(m_rootGroup);\n\n\tfunction addFeature(feature, layerName, pxPerExtent) {\n\t\tconst featureStyle = layer.getFeatureStyle(feature, layerName);\n\t\tif (!featureStyle) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst ftrLyr = featureLayer(feature, layerName, m_rootGroup, pxPerExtent, featureStyle);\n\t\tm_layers.push(ftrLyr);\n\t\tlayer.addFeatureLayer(ftrLyr);\n\t}\n\n\tself.addVectorTile = function addVectorTile(vectorTile) {\n\t\tObject.keys(vectorTile.layers).forEach(layerName => {\n\t\t\tconst layer = vectorTile.layers[layerName];\n\t\t\tconst pxPerExtent = m_tileSize.divideBy(layer.extent);\n\n\t\t\tfor (let i = 0; i != layer.length; ++i) {\n\t\t\t\tconst feature = layer.feature(i);\n\n\t\t\t\taddFeature(feature, layerName, pxPerExtent);\n\t\t\t}\n\t\t});\n\n\t\treturn self;\n\t};\n\n\tself.eachFeatureLayer = func => m_layers.map(func);\n\tself.domElement = () => m_svg;\n\tself.coords = () => coords;\n\n\treturn self;\n}\n","'use strict';\n\nmodule.exports = Pbf;\n\nvar ieee754 = require('ieee754');\n\nfunction Pbf(buf) {\n    this.buf = ArrayBuffer.isView && ArrayBuffer.isView(buf) ? buf : new Uint8Array(buf || 0);\n    this.pos = 0;\n    this.type = 0;\n    this.length = this.buf.length;\n}\n\nPbf.Varint  = 0; // varint: int32, int64, uint32, uint64, sint32, sint64, bool, enum\nPbf.Fixed64 = 1; // 64-bit: double, fixed64, sfixed64\nPbf.Bytes   = 2; // length-delimited: string, bytes, embedded messages, packed repeated fields\nPbf.Fixed32 = 5; // 32-bit: float, fixed32, sfixed32\n\nvar SHIFT_LEFT_32 = (1 << 16) * (1 << 16),\n    SHIFT_RIGHT_32 = 1 / SHIFT_LEFT_32;\n\nPbf.prototype = {\n\n    destroy: function() {\n        this.buf = null;\n    },\n\n    // === READING =================================================================\n\n    readFields: function(readField, result, end) {\n        end = end || this.length;\n\n        while (this.pos < end) {\n            var val = this.readVarint(),\n                tag = val >> 3,\n                startPos = this.pos;\n\n            this.type = val & 0x7;\n            readField(tag, result, this);\n\n            if (this.pos === startPos) this.skip(val);\n        }\n        return result;\n    },\n\n    readMessage: function(readField, result) {\n        return this.readFields(readField, result, this.readVarint() + this.pos);\n    },\n\n    readFixed32: function() {\n        var val = readUInt32(this.buf, this.pos);\n        this.pos += 4;\n        return val;\n    },\n\n    readSFixed32: function() {\n        var val = readInt32(this.buf, this.pos);\n        this.pos += 4;\n        return val;\n    },\n\n    // 64-bit int handling is based on github.com/dpw/node-buffer-more-ints (MIT-licensed)\n\n    readFixed64: function() {\n        var val = readUInt32(this.buf, this.pos) + readUInt32(this.buf, this.pos + 4) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    },\n\n    readSFixed64: function() {\n        var val = readUInt32(this.buf, this.pos) + readInt32(this.buf, this.pos + 4) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    },\n\n    readFloat: function() {\n        var val = ieee754.read(this.buf, this.pos, true, 23, 4);\n        this.pos += 4;\n        return val;\n    },\n\n    readDouble: function() {\n        var val = ieee754.read(this.buf, this.pos, true, 52, 8);\n        this.pos += 8;\n        return val;\n    },\n\n    readVarint: function(isSigned) {\n        var buf = this.buf,\n            val, b;\n\n        b = buf[this.pos++]; val  =  b & 0x7f;        if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 7;  if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 14; if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 21; if (b < 0x80) return val;\n        b = buf[this.pos];   val |= (b & 0x0f) << 28;\n\n        return readVarintRemainder(val, isSigned, this);\n    },\n\n    readVarint64: function() { // for compatibility with v2.0.1\n        return this.readVarint(true);\n    },\n\n    readSVarint: function() {\n        var num = this.readVarint();\n        return num % 2 === 1 ? (num + 1) / -2 : num / 2; // zigzag encoding\n    },\n\n    readBoolean: function() {\n        return Boolean(this.readVarint());\n    },\n\n    readString: function() {\n        var end = this.readVarint() + this.pos,\n            str = readUtf8(this.buf, this.pos, end);\n        this.pos = end;\n        return str;\n    },\n\n    readBytes: function() {\n        var end = this.readVarint() + this.pos,\n            buffer = this.buf.subarray(this.pos, end);\n        this.pos = end;\n        return buffer;\n    },\n\n    // verbose for performance reasons; doesn't affect gzipped size\n\n    readPackedVarint: function(arr, isSigned) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readVarint(isSigned));\n        return arr;\n    },\n    readPackedSVarint: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSVarint());\n        return arr;\n    },\n    readPackedBoolean: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readBoolean());\n        return arr;\n    },\n    readPackedFloat: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFloat());\n        return arr;\n    },\n    readPackedDouble: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readDouble());\n        return arr;\n    },\n    readPackedFixed32: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFixed32());\n        return arr;\n    },\n    readPackedSFixed32: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSFixed32());\n        return arr;\n    },\n    readPackedFixed64: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFixed64());\n        return arr;\n    },\n    readPackedSFixed64: function(arr) {\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSFixed64());\n        return arr;\n    },\n\n    skip: function(val) {\n        var type = val & 0x7;\n        if (type === Pbf.Varint) while (this.buf[this.pos++] > 0x7f) {}\n        else if (type === Pbf.Bytes) this.pos = this.readVarint() + this.pos;\n        else if (type === Pbf.Fixed32) this.pos += 4;\n        else if (type === Pbf.Fixed64) this.pos += 8;\n        else throw new Error('Unimplemented type: ' + type);\n    },\n\n    // === WRITING =================================================================\n\n    writeTag: function(tag, type) {\n        this.writeVarint((tag << 3) | type);\n    },\n\n    realloc: function(min) {\n        var length = this.length || 16;\n\n        while (length < this.pos + min) length *= 2;\n\n        if (length !== this.length) {\n            var buf = new Uint8Array(length);\n            buf.set(this.buf);\n            this.buf = buf;\n            this.length = length;\n        }\n    },\n\n    finish: function() {\n        this.length = this.pos;\n        this.pos = 0;\n        return this.buf.subarray(0, this.length);\n    },\n\n    writeFixed32: function(val) {\n        this.realloc(4);\n        writeInt32(this.buf, val, this.pos);\n        this.pos += 4;\n    },\n\n    writeSFixed32: function(val) {\n        this.realloc(4);\n        writeInt32(this.buf, val, this.pos);\n        this.pos += 4;\n    },\n\n    writeFixed64: function(val) {\n        this.realloc(8);\n        writeInt32(this.buf, val & -1, this.pos);\n        writeInt32(this.buf, Math.floor(val * SHIFT_RIGHT_32), this.pos + 4);\n        this.pos += 8;\n    },\n\n    writeSFixed64: function(val) {\n        this.realloc(8);\n        writeInt32(this.buf, val & -1, this.pos);\n        writeInt32(this.buf, Math.floor(val * SHIFT_RIGHT_32), this.pos + 4);\n        this.pos += 8;\n    },\n\n    writeVarint: function(val) {\n        val = +val || 0;\n\n        if (val > 0xfffffff || val < 0) {\n            writeBigVarint(val, this);\n            return;\n        }\n\n        this.realloc(4);\n\n        this.buf[this.pos++] =           val & 0x7f  | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] =   (val >>> 7) & 0x7f;\n    },\n\n    writeSVarint: function(val) {\n        this.writeVarint(val < 0 ? -val * 2 - 1 : val * 2);\n    },\n\n    writeBoolean: function(val) {\n        this.writeVarint(Boolean(val));\n    },\n\n    writeString: function(str) {\n        str = String(str);\n        this.realloc(str.length * 4);\n\n        this.pos++; // reserve 1 byte for short string length\n\n        var startPos = this.pos;\n        // write the string directly to the buffer and see how much was written\n        this.pos = writeUtf8(this.buf, str, this.pos);\n        var len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    },\n\n    writeFloat: function(val) {\n        this.realloc(4);\n        ieee754.write(this.buf, val, this.pos, true, 23, 4);\n        this.pos += 4;\n    },\n\n    writeDouble: function(val) {\n        this.realloc(8);\n        ieee754.write(this.buf, val, this.pos, true, 52, 8);\n        this.pos += 8;\n    },\n\n    writeBytes: function(buffer) {\n        var len = buffer.length;\n        this.writeVarint(len);\n        this.realloc(len);\n        for (var i = 0; i < len; i++) this.buf[this.pos++] = buffer[i];\n    },\n\n    writeRawMessage: function(fn, obj) {\n        this.pos++; // reserve 1 byte for short message length\n\n        // write the message directly to the buffer and see how much was written\n        var startPos = this.pos;\n        fn(obj, this);\n        var len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    },\n\n    writeMessage: function(tag, fn, obj) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeRawMessage(fn, obj);\n    },\n\n    writePackedVarint:   function(tag, arr) { this.writeMessage(tag, writePackedVarint, arr);   },\n    writePackedSVarint:  function(tag, arr) { this.writeMessage(tag, writePackedSVarint, arr);  },\n    writePackedBoolean:  function(tag, arr) { this.writeMessage(tag, writePackedBoolean, arr);  },\n    writePackedFloat:    function(tag, arr) { this.writeMessage(tag, writePackedFloat, arr);    },\n    writePackedDouble:   function(tag, arr) { this.writeMessage(tag, writePackedDouble, arr);   },\n    writePackedFixed32:  function(tag, arr) { this.writeMessage(tag, writePackedFixed32, arr);  },\n    writePackedSFixed32: function(tag, arr) { this.writeMessage(tag, writePackedSFixed32, arr); },\n    writePackedFixed64:  function(tag, arr) { this.writeMessage(tag, writePackedFixed64, arr);  },\n    writePackedSFixed64: function(tag, arr) { this.writeMessage(tag, writePackedSFixed64, arr); },\n\n    writeBytesField: function(tag, buffer) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeBytes(buffer);\n    },\n    writeFixed32Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeFixed32(val);\n    },\n    writeSFixed32Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeSFixed32(val);\n    },\n    writeFixed64Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeFixed64(val);\n    },\n    writeSFixed64Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeSFixed64(val);\n    },\n    writeVarintField: function(tag, val) {\n        this.writeTag(tag, Pbf.Varint);\n        this.writeVarint(val);\n    },\n    writeSVarintField: function(tag, val) {\n        this.writeTag(tag, Pbf.Varint);\n        this.writeSVarint(val);\n    },\n    writeStringField: function(tag, str) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeString(str);\n    },\n    writeFloatField: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeFloat(val);\n    },\n    writeDoubleField: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeDouble(val);\n    },\n    writeBooleanField: function(tag, val) {\n        this.writeVarintField(tag, Boolean(val));\n    }\n};\n\nfunction readVarintRemainder(l, s, p) {\n    var buf = p.buf,\n        h, b;\n\n    b = buf[p.pos++]; h  = (b & 0x70) >> 4;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 3;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 10; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 17; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 24; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x01) << 31; if (b < 0x80) return toNum(l, h, s);\n\n    throw new Error('Expected varint not more than 10 bytes');\n}\n\nfunction readPackedEnd(pbf) {\n    return pbf.type === Pbf.Bytes ?\n        pbf.readVarint() + pbf.pos : pbf.pos + 1;\n}\n\nfunction toNum(low, high, isSigned) {\n    if (isSigned) {\n        return high * 0x100000000 + (low >>> 0);\n    }\n\n    return ((high >>> 0) * 0x100000000) + (low >>> 0);\n}\n\nfunction writeBigVarint(val, pbf) {\n    var low, high;\n\n    if (val >= 0) {\n        low  = (val % 0x100000000) | 0;\n        high = (val / 0x100000000) | 0;\n    } else {\n        low  = ~(-val % 0x100000000);\n        high = ~(-val / 0x100000000);\n\n        if (low ^ 0xffffffff) {\n            low = (low + 1) | 0;\n        } else {\n            low = 0;\n            high = (high + 1) | 0;\n        }\n    }\n\n    if (val >= 0x10000000000000000 || val < -0x10000000000000000) {\n        throw new Error('Given varint doesn\\'t fit into 10 bytes');\n    }\n\n    pbf.realloc(10);\n\n    writeBigVarintLow(low, high, pbf);\n    writeBigVarintHigh(high, pbf);\n}\n\nfunction writeBigVarintLow(low, high, pbf) {\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos]   = low & 0x7f;\n}\n\nfunction writeBigVarintHigh(high, pbf) {\n    var lsb = (high & 0x07) << 4;\n\n    pbf.buf[pbf.pos++] |= lsb         | ((high >>>= 3) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f;\n}\n\nfunction makeRoomForExtraLength(startPos, len, pbf) {\n    var extraLen =\n        len <= 0x3fff ? 1 :\n        len <= 0x1fffff ? 2 :\n        len <= 0xfffffff ? 3 : Math.ceil(Math.log(len) / (Math.LN2 * 7));\n\n    // if 1 byte isn't enough for encoding message length, shift the data to the right\n    pbf.realloc(extraLen);\n    for (var i = pbf.pos - 1; i >= startPos; i--) pbf.buf[i + extraLen] = pbf.buf[i];\n}\n\nfunction writePackedVarint(arr, pbf)   { for (var i = 0; i < arr.length; i++) pbf.writeVarint(arr[i]);   }\nfunction writePackedSVarint(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeSVarint(arr[i]);  }\nfunction writePackedFloat(arr, pbf)    { for (var i = 0; i < arr.length; i++) pbf.writeFloat(arr[i]);    }\nfunction writePackedDouble(arr, pbf)   { for (var i = 0; i < arr.length; i++) pbf.writeDouble(arr[i]);   }\nfunction writePackedBoolean(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeBoolean(arr[i]);  }\nfunction writePackedFixed32(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeFixed32(arr[i]);  }\nfunction writePackedSFixed32(arr, pbf) { for (var i = 0; i < arr.length; i++) pbf.writeSFixed32(arr[i]); }\nfunction writePackedFixed64(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeFixed64(arr[i]);  }\nfunction writePackedSFixed64(arr, pbf) { for (var i = 0; i < arr.length; i++) pbf.writeSFixed64(arr[i]); }\n\n// Buffer code below from https://github.com/feross/buffer, MIT-licensed\n\nfunction readUInt32(buf, pos) {\n    return ((buf[pos]) |\n        (buf[pos + 1] << 8) |\n        (buf[pos + 2] << 16)) +\n        (buf[pos + 3] * 0x1000000);\n}\n\nfunction writeInt32(buf, val, pos) {\n    buf[pos] = val;\n    buf[pos + 1] = (val >>> 8);\n    buf[pos + 2] = (val >>> 16);\n    buf[pos + 3] = (val >>> 24);\n}\n\nfunction readInt32(buf, pos) {\n    return ((buf[pos]) |\n        (buf[pos + 1] << 8) |\n        (buf[pos + 2] << 16)) +\n        (buf[pos + 3] << 24);\n}\n\nfunction readUtf8(buf, pos, end) {\n    var str = '';\n    var i = pos;\n\n    while (i < end) {\n        var b0 = buf[i];\n        var c = null; // codepoint\n        var bytesPerSequence =\n            b0 > 0xEF ? 4 :\n            b0 > 0xDF ? 3 :\n            b0 > 0xBF ? 2 : 1;\n\n        if (i + bytesPerSequence > end) break;\n\n        var b1, b2, b3;\n\n        if (bytesPerSequence === 1) {\n            if (b0 < 0x80) {\n                c = b0;\n            }\n        } else if (bytesPerSequence === 2) {\n            b1 = buf[i + 1];\n            if ((b1 & 0xC0) === 0x80) {\n                c = (b0 & 0x1F) << 0x6 | (b1 & 0x3F);\n                if (c <= 0x7F) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 3) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0xC | (b1 & 0x3F) << 0x6 | (b2 & 0x3F);\n                if (c <= 0x7FF || (c >= 0xD800 && c <= 0xDFFF)) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 4) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            b3 = buf[i + 3];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80 && (b3 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0x12 | (b1 & 0x3F) << 0xC | (b2 & 0x3F) << 0x6 | (b3 & 0x3F);\n                if (c <= 0xFFFF || c >= 0x110000) {\n                    c = null;\n                }\n            }\n        }\n\n        if (c === null) {\n            c = 0xFFFD;\n            bytesPerSequence = 1;\n\n        } else if (c > 0xFFFF) {\n            c -= 0x10000;\n            str += String.fromCharCode(c >>> 10 & 0x3FF | 0xD800);\n            c = 0xDC00 | c & 0x3FF;\n        }\n\n        str += String.fromCharCode(c);\n        i += bytesPerSequence;\n    }\n\n    return str;\n}\n\nfunction writeUtf8(buf, str, pos) {\n    for (var i = 0, c, lead; i < str.length; i++) {\n        c = str.charCodeAt(i); // code point\n\n        if (c > 0xD7FF && c < 0xE000) {\n            if (lead) {\n                if (c < 0xDC00) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                    lead = c;\n                    continue;\n                } else {\n                    c = lead - 0xD800 << 10 | c - 0xDC00 | 0x10000;\n                    lead = null;\n                }\n            } else {\n                if (c > 0xDBFF || (i + 1 === str.length)) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                } else {\n                    lead = c;\n                }\n                continue;\n            }\n        } else if (lead) {\n            buf[pos++] = 0xEF;\n            buf[pos++] = 0xBF;\n            buf[pos++] = 0xBD;\n            lead = null;\n        }\n\n        if (c < 0x80) {\n            buf[pos++] = c;\n        } else {\n            if (c < 0x800) {\n                buf[pos++] = c >> 0x6 | 0xC0;\n            } else {\n                if (c < 0x10000) {\n                    buf[pos++] = c >> 0xC | 0xE0;\n                } else {\n                    buf[pos++] = c >> 0x12 | 0xF0;\n                    buf[pos++] = c >> 0xC & 0x3F | 0x80;\n                }\n                buf[pos++] = c >> 0x6 & 0x3F | 0x80;\n            }\n            buf[pos++] = c & 0x3F | 0x80;\n        }\n    }\n    return pos;\n}\n","/*\n * Copyright 2017, Joachim Kuebart <joachim.kuebart@gmail.com>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n *   1. Redistributions of source code must retain the above copyright\n *\tnotice, this list of conditions and the following disclaimer.\n *\n *   2. Redistributions in binary form must reproduce the above copyright\n *\tnotice, this list of conditions and the following disclaimer in the\n *\tdocumentation and/or other materials provided with the\n *\tdistribution.\n *\n *   3. Neither the name of the copyright holder nor the names of its\n *\tcontributors may be used to endorse or promote products derived\n *\tfrom this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport featureTile from './FeatureTile.js';\nimport './fetch.js';\nimport { GridLayer, Util } from 'leaflet';\nimport Pbf from 'pbf';\nimport { VectorTile } from 'vector-tile';\n\nfunction err() {\n\treturn new Error(Array.prototype.join.call(arguments, ': '));\n}\n\nfunction load(url) {\n\treturn fetch(url).then(response => {\n\t\tif (response.ok) {\n\t\t\treturn response.arrayBuffer();\n\t\t}\n\t\tif (404 !== response.status) {\n\t\t\tthrow err(url, response.status, response.statusText);\n\t\t}\n\t});\n}\n\nfunction tileId(coords) {\n\treturn [ coords.x, coords.y, coords.z ].join('|');\n}\n\nconst defaultOptions = {\n\tminZoom: 0,\n\tmaxZoom: 18,\n\tmaxDetailZoom: void 0,\n\tminDetailZoom: void 0,\n\tsubdomains: 'abc',\n\tzoomOffset: 0,\n\tzoomReverse: false,\n};\n\nexport default function vectorTileLayer(url, options) {\n\tconst self = new GridLayer(options);\n\tconst m_super = Object.getPrototypeOf(self);\n\n\toptions = Util.extend({}, defaultOptions, options);\n\n\tif ('string' === typeof options.subdomains) {\n\t\toptions.subdomains = options.subdomains.split('');\n\t}\n\n\t// Compatibility with Leaflet.VectorGrid\n\tif (options.vectorTileLayerStyles) {\n\t\toptions.style = legacyStyle;\n\t}\n\n\tconst m_featureTiles = {};\n\tself.on('tileunload', evt => {\n\t\tconst id = tileId(evt.coords);\n\t\tconst tile = m_featureTiles[id];\n\n\t\tif (!tile) {\n\t\t\treturn;\n\t\t}\n\t\ttile.eachFeatureLayer(featureLayer =>\n\t\t\tself.removeFeatureLayer(featureLayer)\n\t\t);\n\t\tdelete m_featureTiles[id];\n\t});\n\n\tlet m_map;\n\tself.onAdd = function onAdd(map) {\n\t\tm_map = map;\n\t\treturn m_super.onAdd.apply(self, arguments);\n\t};\n\n\tself.onRemove = function onRemove(map) {\n\t\tm_map = void 0;\n\t\treturn m_super.onRemove.apply(self, arguments);\n\t};\n\n\tself.createTile = function createTile(coords, done) {\n\t\tconst id = tileId(coords);\n\t\tconst tile = m_featureTiles[id] = featureTile(coords, self);\n\n\t\tload(self.getTileUrl(coords)).then(buffer => {\n\t\t\ttile.addVectorTile(new VectorTile(new Pbf(buffer)));\n\t\t\tdone(null, tile);\n\t\t});\n\n\t\treturn tile.domElement();\n\t};\n\n\tself.getTileUrl = function getTileUrl(coords) {\n\t\tconst data = {\n\t\t\ts: getSubdomain(coords),\n\t\t\tx: coords.x,\n\t\t\ty: coords.y,\n\t\t\tz: getZoomForUrl(coords.z)\n\t\t};\n\t\treturn Util.template(\n\t\t\turl,\n\t\t\tUtil.extend(data, options)\n\t\t);\n\t};\n\n\tself.setStyle = function setStyle(style) {\n\t\toptions.style = style;\n\n\t\teachFeatureLayer(featureLayer => {\n\t\t\tconst { feature, layerName } = featureLayer;\n\t\t\tconst featureStyle = self.getFeatureStyle(feature, layerName);\n\n\t\t\tfeatureLayer.setStyle(featureStyle);\n\t\t});\n\n\t\treturn self;\n\t};\n\n\t// Compatibilty with Leaflet.VectorGrid\n\tconst m_featureStyle = {};\n\tself.setFeatureStyle = function setFeatureStyle(id, style) {\n\t\tm_featureStyle[id] = style;\n\t\tself.setStyle(options.style);\n\n\t\treturn self;\n\t};\n\n\t// Compatibilty with Leaflet.VectorGrid\n\tself.resetFeatureStyle = function resetFeatureStyle(id) {\n\t\tdelete m_featureStyle[id];\n\t\tself.setStyle(options.style);\n\n\t\treturn self;\n\t};\n\n\tself.getTileSize = function getTileSize() {\n\t\tconst tileSize = m_super.getTileSize.call(self);\n\t\tconst zoom = self._tileZoom;\n\n\t\treturn tileSize.divideBy(m_map.getZoomScale(clampZoom(zoom), zoom)).round();\n\t};\n\n\tself.getFeatureStyle = function getFeatureStyle(feature, layerName) {\n\t\tconst style = options.style;\n\n\t\treturn 'function' === typeof style\n\t\t       ? style(feature, layerName)\n\t\t       : style;\n\t};\n\n\tself.addFeatureLayer = function addFeatureLayer(featureLayer) {\n\t\tfeatureLayer.addTo(m_map);\n\t\tfeatureLayer.addEventParent(self);\n\n\t\treturn self;\n\t};\n\n\tself.removeFeatureLayer = function removeFeatureLayer(featureLayer) {\n\t\tfeatureLayer.removeEventParent(self);\n\t\tfeatureLayer.removeFrom(m_map);\n\n\t\treturn self;\n\t}\n\n\tfunction eachFeatureLayer(func) {\n\t\tObject.keys(m_featureTiles).forEach(\n\t\t\ttileId => m_featureTiles[tileId].eachFeatureLayer(func)\n\t\t);\n\t}\n\n\tfunction clampZoom(zoom) {\n\t\tconst { minDetailZoom, maxDetailZoom } = options;\n\n\t\tif (void 0 !== minDetailZoom && zoom < minDetailZoom) {\n\t\t\treturn minDetailZoom;\n\t\t}\n\n\t\tif (void 0 !== maxDetailZoom && maxDetailZoom < zoom) {\n\t\t\treturn maxDetailZoom;\n\t\t}\n\n\t\treturn zoom;\n\t}\n\n\tfunction getZoomForUrl(zoom) {\n\t\tconst { maxZoom, zoomReverse, zoomOffset } = options;\n\n\t\tif (zoomReverse) {\n\t\t\tzoom = maxZoom - zoom;\n\t\t}\n\n\t\treturn clampZoom(zoom + zoomOffset);\n\t}\n\n\tfunction getSubdomain(tilePoint) {\n\t\tconst index = Math.abs(tilePoint.x + tilePoint.y) % options.subdomains.length;\n\t\treturn options.subdomains[index];\n\t}\n\n\tfunction legacyStyle(feature, layerName) {\n\t\tconst { getFeatureId, vectorTileLayerStyles } = options;\n\n\t\tlet layerStyle = vectorTileLayerStyles[layerName];\n\t\tif (getFeatureId) {\n\t\t\tconst fId = getFeatureId(feature);\n\t\t\tif (m_featureStyle[fId]) {\n\t\t\t\tlayerStyle = m_featureStyle[fId];\n\t\t\t}\n\t\t}\n\n\t\tif (layerStyle instanceof Function) {\n\t\t\tlayerStyle = layerStyle(feature.properties, 0);\n\t\t}\n\n\t\tif (layerStyle instanceof Array) {\n\t\t\tif (!layerStyle.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlayerStyle = layerStyle[0];\n\t\t}\n\n\t\treturn layerStyle;\n\t}\n\n\treturn self;\n}\n","/*\n * Copyright 2017, Joachim Kuebart <joachim.kuebart@gmail.com>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n *   1. Redistributions of source code must retain the above copyright\n *\tnotice, this list of conditions and the following disclaimer.\n *\n *   2. Redistributions in binary form must reproduce the above copyright\n *\tnotice, this list of conditions and the following disclaimer in the\n *\tdocumentation and/or other materials provided with the\n *\tdistribution.\n *\n *   3. Neither the name of the copyright holder nor the names of its\n *\tcontributors may be used to endorse or promote products derived\n *\tfrom this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport './flatMap.js';\n\n    function zip() {\n\tconst args = Array.prototype.slice.call(arguments);\n\treturn Object.keys(args[0]).map(i => args.map(a => a[i]));\n    }\n\n    /**\n     * An immutable value type for summaries.\n     */\n    function summary() {\n\treturn summaryImp(0, 0);\n\n\t// Private implementation\n\tfunction summaryImp(m_walks, m_distance) {\n\t    const self = {};\n\n\t    self.walks = () => m_walks;\n\t    self.distance = () => m_distance;\n\n\t    self.toString = function toString() {\n\t\treturn [\n\t\t    `${m_walks} walks`, +(m_distance / 1000).toFixed(1) +'km',\n\t\t].join(' — ');\n\t    };\n\n\t    self.accumulate = function accumulate(dist) {\n\t\treturn summaryImp(1 + m_walks, dist + m_distance);\n\t    };\n\n\t    return self;\n\t}\n    }\n\n    /**\n     * The summary pane reacts to changes in the visible year layers.\n     */\n    export function summaryPane(walks, onChange) {\n\tconst self = {};\n\tconst m_visibleYears = {};\n\tlet m_summary = summary();\n\n\tfunction handleVisible(year, visible) {\n\t    if (visible != m_visibleYears[year]) {\n\t\tm_visibleYears[year] = visible;\n\t\tm_summary = walks.flatMap(\n\t\t\twalk => zip(walk.dates, walk.distances)\n\t\t    ).reduce(function (sum, dateDistance) {\n\t\t\tif (m_visibleYears[dateDistance[0].substr(0, 4)]) {\n\t\t\t    return sum.accumulate(dateDistance[1]);\n\t\t\t} else {\n\t\t\t    return sum;\n\t\t\t}\n\t\t    }, summary());\n\t\tif (onChange) {\n\t\t    onChange.call(self);\n\t\t}\n\t    }\n\t}\n\n\tself.addLayer = function addLayer(layer, year) {\n\t    layer.on('add', handleVisible.bind(null, year, true)).\n\t\ton('remove', handleVisible.bind(null, year, false));\n\t    return self;\n\t};\n\n\tself.removeLayer = function removeLayer(layer) {\n\t    layer.off('add').off('remove');\n\t    return self;\n\t};\n\n\tself.render = function render() {\n\t    const frag = document.createDocumentFragment();\n\t    if (m_summary.walks()) {\n\t\tconst div = document.createElement('div');\n\t\tdiv.textContent = ''+ m_summary;\n\t\tfrag.appendChild(div);\n\t    }\n\t    return frag;\n\t};\n\n\treturn self;\n    }\n","/*\n * Copyright 2017, Joachim Kuebart <joachim.kuebart@gmail.com>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n *   1. Redistributions of source code must retain the above copyright\n *\tnotice, this list of conditions and the following disclaimer.\n *\n *   2. Redistributions in binary form must reproduce the above copyright\n *\tnotice, this list of conditions and the following disclaimer in the\n *\tdocumentation and/or other materials provided with the\n *\tdistribution.\n *\n *   3. Neither the name of the copyright holder nor the names of its\n *\tcontributors may be used to endorse or promote products derived\n *\tfrom this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport './flatMap.js';\nimport {\n\tcontrol,\n\tDomEvent,\n\tDomUtil,\n\tGeoJSON,\n\tlatLngBounds,\n\tlayerGroup,\n\tmap,\n\ttileLayer\n} from 'leaflet';\nimport vectorTileLayer from 'leaflet-vector-tile-layer';\nimport require from 'require';\nimport { summaryPane } from './summary.js';\n\nexport const CSS = {\n    'DETAILS': 'gpxmap-details',\n    'HBOX': 'gpxmap-hbox',\n    'SELECT': 'gpxmap-select',\n    'TRACK': 'gpxmap-track',\n    'VBOX': 'gpxmap-vbox',\n    'VIEW': 'gpxmap-view',\n};\n\n/**\n * If this looks familiar that's because it's binary search. We find\n * 0 <= i <= array.length such that !pred(i - 1) && pred(i) under the\n * assumption !pred(-1) && pred(length).\n */\nfunction search(array, pred) {\n    let le = -1, ri = array.length;\n    while (1 + le !== ri) {\n\tconst mi = le + ((ri - le) >> 1);\n\tif (pred(array[mi])) {\n\t    ri = mi;\n\t} else {\n\t    le = mi;\n\t}\n    }\n    return ri;\n}\n\nfunction yearColour(idx) {\n    return ['hsl(',\n\t170 + 45 * (idx >> 1), ',',\n\t100, '%,',\n\t27 * (1 + idx % 2), '%)'\n    ].join('');\n}\n\nfunction walkPopup(date, walk) {\n    const idx = search(walk.dates, d => date <= d);\n\n    if (walk.dates[idx] !== date) {\n\tconsole.log('walkPopup', date, walk);\n\treturn;\n    }\n\n    const popup = document.createDocumentFragment();\n    let elem0 = document.createElement('div');\n    elem0.textContent = [\n\t    [ +date.substr(8, 2)\n\t    , +date.substr(5, 2)\n\t    , +date.substr(0, 4)\n\t    ].join('/'),\n\t    +(walk.distances[idx] / 1000).toFixed(1) +'km',\n\t    `${walk.walkers} walkers`,\n\t    walk.categories.join(' — '),\n\t    '',\n\t].join(' — ');\n\n    const anchor = document.createElement('a');\n    anchor.setAttribute('href', walk.link);\n    anchor.textContent = 'blog';\n    elem0.appendChild(anchor);\n    popup.appendChild(elem0);\n\n    elem0 = document.createElement('p');\n    elem0.textContent = walk.people.sort().join(' • ');\n    popup.appendChild(elem0);\n\n    return { 'title': walk.title, 'content': popup };\n}\n\nfunction getFeatureId(walk) {\n    return walk.properties.date;\n}\n\nfunction locationState(obj) {\n    const state = window.history.state || {};\n\n    if (obj) {\n\tObject.keys(obj).forEach(k => state[k] = obj[k]);\n\twindow.history.replaceState(state, window.document.title);\n    }\n\n    return state;\n}\n\nfunction locationItem(key) {\n    return function (value) {\n\tif (!arguments.length) {\n\t    return locationState()[key];\n\t}\n\n\tlocationState({ [key]: value });\n\treturn value;\n    }\n}\n\nfunction savedLocation(l) {\n    if (!arguments.length) {\n\treturn locationState()['@'];\n    }\n\n    const { lat, lng } = L.latLng(l);\n    locationState({ '@': [ lat, lng ].map(f => +f.toFixed(6)) });\n    return l;\n}\n\nconst savedZoom = locationItem('z');\nconst selected = locationItem('s');\n\nfunction hiddenYear(year, hidden) {\n    const state = [].concat(locationState()['y'] || []);\n    if (arguments.length < 2) {\n\treturn 0 <= state.indexOf(`${year}`);\n    }\n\n    const years = state.reduce((h, k) => (h[k] = true, h), {});\n    years[year] = hidden;\n    const newState = Object.keys(years).filter(k => years[k]).sort();\n    locationState({ 'y': newState.length ? newState : void 0 });\n    return hidden;\n}\n\nexport function gpxmap(id, options) {\n    // Create all configured tile layers.\n    const tileLayers = options.tileLayers.map(function (layer) {\n\treturn {\n\t    'name': layer.name,\n\t    'tileLayer': tileLayer(layer.url, layer.options),\n\t};\n    });\n\n    // Create layers control.\n    const layersControl = control.layers(null, null, { 'hideSingleBase':true });\n    tileLayers.forEach(function (layer) {\n\tlayersControl.addBaseLayer(layer.tileLayer, layer.name);\n    });\n\n    // Create the DOM structure for our map.\n    const domContainer = DomUtil.get(id);\n    DomUtil.addClass(domContainer, CSS.VBOX);\n\n    // Create map with an initial tile layer and layers control.\n    const gpxmap = map(DomUtil.create('div', CSS.VIEW, domContainer)).\n\taddControl(control.scale()).\n\taddControl(layersControl).\n\taddLayer(tileLayers[0].tileLayer);\n\n    const domDetails = DomUtil.create('div', CSS.DETAILS, domContainer);\n    function renderDetails({ title, content }) {\n\tconst h3 = DomUtil.create('h3');\n\n\th3.textContent = title;\n\tDomUtil.empty(domDetails);\n\tdomDetails.appendChild(h3);\n\tdomDetails.appendChild(content);\n    }\n\n    let hover;\n    function trackStyle(feature) {\n\tconst date = feature.properties.date;\n\tconst year = date.substr(0, 4);\n\treturn {\n\t    'className': CSS.TRACK,\n\t    'color': yearColour(year - 2011),\n\t    'opacity': hiddenYear(year) ? 0 : date === hover ? 1 : .8,\n\t    'weight': date === hover ? 4 : date === selected() ? 3.5 : 2,\n\t    'interactive': false,\n\t};\n    }\n    function mouseStyle(feature) {\n\tconst year = feature.properties.date.substr(0, 4);\n\treturn {\n\t    'opacity': 0,\n\t    'weight': 20,\n\t    'interactive': !hiddenYear(year),\n\t};\n    }\n\n    // This layer shows walking tracks.\n    const walkLayer = vectorTileLayer(\n\toptions.url, {\n\t    'pane': 'overlayPane',\n\t    'maxDetailZoom': 13,\n\t    getFeatureId,\n\t    'style': trackStyle,\n\t}\n    ).addTo(gpxmap);\n\n    // This layer has invisible mouse-responsive tracks.\n    const mouseLayer = vectorTileLayer(\n\toptions.url, {\n\t    'pane': 'overlayPane',\n\t    'maxDetailZoom': 13,\n\t    getFeatureId,\n\t    'style': mouseStyle,\n\t    'interactive': true, // for Leaflet.VectorGrid\n\t}\n    ).on('mouseover', function (evt) {\n\thover = getFeatureId(evt.layer);\n\twalkLayer.setStyle(trackStyle);\n    }).on('mouseout', function () {\n\thover = void 0;\n\twalkLayer.setStyle(trackStyle);\n    }).addTo(gpxmap);\n\n    require([ `dA/json!${options.index}` ], function (walks) {\n\t// Collect all years.\n\tconst years = {};\n\twalks.flatMap(walk => walk.dates).\n\t    forEach(date => years[date.substr(0, 4)] = true);\n\n\t// Build popup from matching index entry.\n\tmouseLayer.on('click', function (evt) {\n\t    const date = getFeatureId(evt.layer);\n\n\t    DomEvent.stopPropagation(evt);\n\t    if (date === selected()) {\n\t\treturn;\n\t    }\n\t    deselect();\n\t    selected(date);\n\t    walkLayer.setStyle(trackStyle);\n\n\t    renderSummary();\n\t});\n\n\t// Set up a summary pane that reacts when years are toggled.\n\tconst sumPane = summaryPane(walks, renderSummary);\n\tfunction renderSummary() {\n\t    const date = selected();\n\n\t    if (date) {\n\t\tconst idx = search(walks, walk => date < walk.dates[0]) - 1;\n\t\tconst popup = walkPopup(date, walks[idx]);\n\t\tif (popup) {\n\t\t    return renderDetails(popup);\n\t\t}\n\t    }\n\n\t    return renderDetails({\n\t\t'title': options.title,\n\t\t'content': sumPane.render(),\n\t    });\n\t}\n\n\tfunction deselect() {\n\t    if (selected()) {\n\t\tselected(void 0);\n\t\twalkLayer.setStyle(trackStyle);\n\t\trenderSummary();\n\t    }\n\t}\n\tgpxmap.on('click', deselect);\n\n\t// Create one layer group per year and add to the map.\n\tObject.keys(years).forEach(function (year) {\n\t    const lg = layerGroup().on('add', function () {\n\t\tif (hiddenYear(year)) {\n\t\t    hiddenYear(year, false);\n\t\t    walkLayer.setStyle(trackStyle);\n\t\t    mouseLayer.setStyle(mouseStyle);\n\t\t}\n\t    }).on('remove', function () {\n\t\tif (!hiddenYear(year)) {\n\t\t    hiddenYear(year, true);\n\t\t    walkLayer.setStyle(trackStyle);\n\t\t    mouseLayer.setStyle(mouseStyle);\n\t\t}\n\t    });\n\t    if (!hiddenYear(year)) {\n\t\tgpxmap.addLayer(lg);\n\t    }\n\t    layersControl.addOverlay(lg, year);\n\t    sumPane.addLayer(lg, year);\n\t});\n\n\t// Adjust the map's viewport when all GPX tracks are loaded\n\tconst bounds = latLngBounds(walks.flatMap(walk => walk.bboxes).\n\t    flatMap(function (bbox) {\n\t\tconst l = bbox.length >> 1;\n\t\treturn GeoJSON.coordsToLatLngs([\n\t\t    [ bbox[0], bbox[1] ], [ bbox[l], bbox[1 + l] ]\n\t\t]);\n\t    })\n\t);\n\tgpxmap.setMaxBounds(bounds.pad(.05));\n\tif (0 <= savedZoom()) {\n\t    try {\n\t\tgpxmap.setView(savedLocation(), savedZoom());\n\t    } catch (exc) {\n\t\tconsole.error(exc);\n\t\tgpxmap.fitBounds(bounds);\n\t    }\n\t} else {\n\t    gpxmap.fitBounds(bounds);\n\t}\n\tgpxmap.on('moveend', function () {\n\t    savedLocation(this.getCenter());\n\t    savedZoom(this.getZoom());\n\t});\n    });\n\n    return gpxmap;\n}\n","/*\n * Copyright 2017, Joachim Kuebart <joachim.kuebart@gmail.com>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n *   1. Redistributions of source code must retain the above copyright\n *\tnotice, this list of conditions and the following disclaimer.\n *\n *   2. Redistributions in binary form must reproduce the above copyright\n *\tnotice, this list of conditions and the following disclaimer in the\n *\tdocumentation and/or other materials provided with the\n *\tdistribution.\n *\n *   3. Neither the name of the copyright holder nor the names of its\n *\tcontributors may be used to endorse or promote products derived\n *\tfrom this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n\n// Missing monadic operation\nif ('function' !== typeof Array.prototype.flatMap) {\n    Object.defineProperty(Array.prototype, 'flatMap', {\n\t'value': function flatMap() {\n\t    'use strict';\n\n\t    // return [].concat(f(this[0]), f(this[1]), ...)\n\t    return Array.prototype.concat.apply([],\n\t\tArray.prototype.map.apply(this, arguments)\n\t    );\n\t},\n    });\n}\n","module.exports.VectorTile = require('./lib/vectortile.js');\nmodule.exports.VectorTileFeature = require('./lib/vectortilefeature.js');\nmodule.exports.VectorTileLayer = require('./lib/vectortilelayer.js');\n","/*\n * Copyright 2017, Joachim Kuebart <joachim.kuebart@gmail.com>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n *   1. Redistributions of source code must retain the above copyright\n *\tnotice, this list of conditions and the following disclaimer.\n *\n *   2. Redistributions in binary form must reproduce the above copyright\n *\tnotice, this list of conditions and the following disclaimer in the\n *\tdocumentation and/or other materials provided with the\n *\tdistribution.\n *\n *   3. Neither the name of the copyright holder nor the names of its\n *\tcontributors may be used to endorse or promote products derived\n *\tfrom this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n\nif ('function' !== typeof window.fetch) {\n\twindow.fetch = function fetch(url) {\n\t\tconst xhr = new XMLHttpRequest();\n\n\t\txhr.open('GET', url);\n\t\txhr.responseType = 'arraybuffer';\n\n\t\treturn new Promise(resolve => {\n\t\t\txhr.onload = function onload() {\n\t\t\t\tresolve({\n\t\t\t\t\tok: 200 === xhr.status,\n\t\t\t\t\tstatus: xhr.status,\n\t\t\t\t\tstatusText: xhr.statusText,\n\t\t\t\t\tarrayBuffer() { return xhr.response; },\n\t\t\t\t});\n\t\t\t};\n\t\t\txhr.send();\n\t\t});\n\t};\n}\n","exports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = nBytes * 8 - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = nBytes * 8 - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = (value * c - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n"],"names":["Point","x","y","this","VectorTileFeature","pbf","end","extent","keys","values","properties","type","_pbf","_geometry","_keys","_values","readFields","readFeature","tag","feature","id","readVarint","readTag","pos","key","value","classifyRings","rings","len","length","polygon","ccw","polygons","i","area","signedArea","undefined","push","ring","p1","p2","sum","j","VectorTileLayer","version","name","_features","readLayer","layer","readString","readValueMessage","readFloat","readDouble","readVarint64","readSVarint","readBoolean","VectorTile","layers","readTile","featureLayer","layerName","rootGroup","pxPerExtent","options","const","self","Layer","Object","getPrototypeOf","extend","addTo","map","_map","addInteractiveTarget","m_path","removeFrom","removeInteractiveTarget","setStyle","path","m_type","Polygon","prototype","Path","stroke","setAttribute","color","opacity","weight","lineCap","lineJoin","dashArray","removeAttribute","dashOffset","fill","fillColor","fillOpacity","fillRule","interactive","DomUtil","addClass","removeClass","SVG","create","types","geometry","loadGeometry","p","point","scaleBy","pointsToPath","className","appendChild","featureTile","coords","addFeature","featureStyle","getFeatureStyle","ftrLyr","m_rootGroup","m_layers","addFeatureLayer","m_tileSize","getTileSize","m_svg","join","addVectorTile","vectorTile","forEach","let","divideBy","eachFeatureLayer","func","domElement","Pbf","buf","ArrayBuffer","isView","Uint8Array","readVarintRemainder","l","s","h","b","toNum","Error","readPackedEnd","Bytes","low","high","isSigned","writeBigVarint","val","realloc","writeBigVarintLow","writeBigVarintHigh","lsb","makeRoomForExtraLength","startPos","extraLen","Math","ceil","log","LN2","writePackedVarint","arr","writeVarint","writePackedSVarint","writeSVarint","writePackedFloat","writeFloat","writePackedDouble","writeDouble","writePackedBoolean","writeBoolean","writePackedFixed32","writeFixed32","writePackedSFixed32","writeSFixed32","writePackedFixed64","writeFixed64","writePackedSFixed64","writeSFixed64","readUInt32","writeInt32","readInt32","readUtf8","str","b0","c","bytesPerSequence","b1","b2","b3","String","fromCharCode","writeUtf8","lead","charCodeAt","err","Array","call","arguments","load","url","fetch","then","response","ok","arrayBuffer","status","statusText","tileId","z","vectorTileLayer","m_featureTiles","clampZoom","zoom","minDetailZoom","maxDetailZoom","getZoomForUrl","maxZoom","zoomReverse","zoomOffset","getSubdomain","tilePoint","index","abs","subdomains","legacyStyle","getFeatureId","vectorTileLayerStyles","layerStyle","fId","m_featureStyle","Function","GridLayer","m_super","Util","defaultOptions","split","style","on","evt","tile","removeFeatureLayer","m_map","onAdd","apply","onRemove","createTile","done","getTileUrl","buffer","data","template","setFeatureStyle","resetFeatureStyle","tileSize","_tileZoom","getZoomScale","round","addEventParent","removeEventParent","zip","args","slice","a","summary","summaryImp","m_walks","m_distance","walks","distance","toString","toFixed","accumulate","dist","summaryPane","onChange","handleVisible","year","visible","m_visibleYears","m_summary","flatMap","walk","dates","distances","reduce","dateDistance","substr","addLayer","bind","removeLayer","off","render","frag","document","createDocumentFragment","div","createElement","textContent","search","array","pred","le","ri","mi","yearColour","idx","walkPopup","date","d","console","popup","elem0","categories","anchor","link","people","sort","title","content","locationState","obj","state","window","history","k","replaceState","locationItem","savedLocation","L","latLng","lat","lng","@","f","hiddenYear","hidden","concat","indexOf","years","newState","filter","gpxmap","renderDetails","ref","h3","empty","domDetails","trackStyle","CSS","TRACK","hover","selected","mouseStyle","tileLayers","tileLayer","layersControl","control","hideSingleBase","addBaseLayer","domContainer","get","VBOX","VIEW","addControl","scale","DETAILS","walkLayer","pane","mouseLayer","require","renderSummary","sumPane","deselect","DomEvent","stopPropagation","lg","layerGroup","addOverlay","bounds","latLngBounds","bboxes","bbox","GeoJSON","coordsToLatLngs","setMaxBounds","pad","savedZoom","setView","exc","error","fitBounds","getCenter","getZoom","defineProperty","clone","add","_add","sub","_sub","mult","_mult","_div","rotate","_rotate","matMult","m","_matMult","unit","_unit","perp","_perp","_round","mag","sqrt","equals","distSqr","dx","dy","angle","atan2","angleTo","angleWith","angleWithSep","cos","sin","convert","isArray","require$$0","line","cmd","lines","cmdLen","x1","Infinity","x2","y1","y2","toGeoJSON","project","y0","size","x0","PI","atan","exp","pow","points","result","coordinates","require$$1","xhr","XMLHttpRequest","open","responseType","Promise","resolve","onload","send","offset","isLE","mLen","nBytes","e","eLen","eMax","eBias","nBits","NaN","rt","isNaN","floor","ieee754","Varint","Fixed64","Fixed32","SHIFT_LEFT_32","SHIFT_RIGHT_32","destroy","readField","skip","readMessage","readFixed32","readSFixed32","readFixed64","readSFixed64","read","num","Boolean","readBytes","subarray","readPackedVarint","readPackedSVarint","readPackedBoolean","readPackedFloat","readPackedDouble","readPackedFixed32","readPackedSFixed32","readPackedFixed64","readPackedSFixed64","writeTag","min","set","finish","writeString","write","writeBytes","writeRawMessage","fn","writeMessage","writeBytesField","writeFixed32Field","writeSFixed32Field","writeFixed64Field","writeSFixed64Field","writeVarintField","writeSVarintField","writeStringField","writeFloatField","writeDoubleField","writeBooleanField","minZoom","HBOX","SELECT"],"mappings":"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"}